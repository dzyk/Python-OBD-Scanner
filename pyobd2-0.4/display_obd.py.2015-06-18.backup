#!/usr/bin/python

import obd
from obd.message.request import OBDRequest

import time

interface = None

while not interface:
	try:
		interface = obd.interface.create('/dev/ttyUSB0', '--port')
	except obd.exception.OBDException as oe:
		print(str(oe))
		time.sleep(1)

interface.open()
interface.set_protocol(None)

while not interface.connected_to_vehicle:
	try:
		interface.connect_to_vehicle()
	except obd.exception.ConnectionError as ce:
		print(str(ce))

message_string = ''

while True:

	request = obd.message.OBDRequest(sid=0x01, pid=0x05)

	responses = interface.send_request(request)
	message_string = str(responses[0].values[0].label).strip() + '=' + str((responses[0].values[0].value * 1.8) + 32.0).ljust(5, '0')[:5] + ' deg F; '

	request = obd.message.OBDRequest(sid=0x01, pid=0x0d)
	responses = interface.send_request(request)
	message_string += str(responses[0].values[0].label).strip() + '=' + str(responses[0].values[0].value / 1.609344).ljust(5, '0')[:5] + ' mph; '

	request = obd.message.OBDRequest(sid=0x01, pid=0x42)
	responses = interface.send_request(request)
	message_string += str(responses[0].values[0].label).strip() + '=' + str(responses[0].values[0].value).ljust(5, '0')[:5] + ' V'

	print(message_string)

interface.disconnect_from_vehicle()
interface.close()
